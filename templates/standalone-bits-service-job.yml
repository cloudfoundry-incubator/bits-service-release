releases:
  - (( merge ))
  - { name: bits-service, version: latest }

instance_groups:
- name: bits-service
  azs: [ z1 ]
  instances: 1
  jobs:
  - { name: bits-service, release: bits-service }
  vm_type: bits_service_vm
  stemcell: default
  networks:
    - name: default
    - name: static
      static_ips:
        - (( grab $BITS_SERVICE_JOB_IP ))
      default: [dns, gateway]
  env:
    bosh:
      keep_root_password: true
      # https://github.com/cloudfoundry/bosh-softlayer-cpi-release/blob/master/docs/concourse_sample_v2_schema.yml#L65-L67
      # http://www.starkandwayne.com/blog/hardening-the-vcap-users-password-on-bosh-vms/
      # mkpasswd --method=sha-512 --salt="4gDD3aV0rdqlrKC" c1oudc0w
      password: $6$4gDD3aV0rdqlrKC$2axHCxGKIObs6tAmMTqYCspcdvQXh3JJcvWOY2WGb4SrdXtnCyNaWlrf3WEqvYR2MYizEGp3kMmbpwBC6jsHt0

properties:
  bits-service:
    private_endpoint: (( concat "http://internal." instance_groups.bits-service.networks.static.static_ips.0 ".xip.io" ))
    public_endpoint: (( concat "http://" instance_groups.bits-service.networks.static.static_ips.0 ".xip.io" ))
    secret: 12345
    signing_users:
    - username: admin
      password: admin
